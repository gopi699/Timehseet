<div class="">

    <form [formGroup]="stickyForm">
        <div class="flex header-linesolvee p-3 gap-10 w-full h-25 bg-white mt-1">
            <div class="w-full">
                <label class="w-full" for="">Employee</label>
                <select class="w-full header-linesolvee rounded h-10" formControlName="employee_Pk_Id">
                    <option value="">--Select--</option>
                    <option *ngFor="let Employee of Employees" [value]="Employee.user_Pk_Id">{{Employee.userName }}
                    </option>
                </select>
            </div>
            <div class="w-full ">
                <label class="w-full" for="">Leave Type</label>
                <select class="w-full header-linesolvee rounded h-10" formControlName="leave_Type">
                    <option value="">--Select--</option>
                    <option *ngFor="let ltype of Leavetype" [value]="ltype.id">{{ ltype.description }}
                    </option>
                </select>
            </div>
            <div class="w-full">
                <label class="w-full" for="">From Date</label>
                <input class="w-full header-linesolvee rounded h-10" type="date" formControlName="from_Date">
            </div>
            <div class="w-full">
                <label class="w-full " for="">To Date</label>
                <input class="w-full header-linesolvee rounded h-10" type="date" formControlName="to_Date">

            </div>
            <div class="w-full">
                <label class="w-full" for="">Status</label>
                <select class="w-full header-linesolvee rounded h-10" formControlName="pk_Status_Id">
                    <option value="">--Select--</option>
                    <option *ngFor="let status of status" [value]="status.id">{{ status.description }}
                </select>
            </div>
            <button class="bg-blue-500 mt-3 text-white p-1 rounded h-9 relative top-4 cursor-pointer" type="button" (click)="onSearch()">Search</button>

        </div>
    </form>

    <div *ngIf="submittedleave.length > 0">
        <div class=" mt-2">
            <button class="bg-green-700 text-white w-20 h-8 rounded cursor-pointer" (click)="approveAll()" [disabled]="isAllApprovedOrRejected()">Approve</button>
            <button class="bg-red-600 text-white w-20 h-8 rounded ml-3 cursor-pointer" (click)="rejectAll()" [disabled]="isAllApprovedOrRejected()">Reject</button>
        </div>
    </div>

</div>

<div class="static w-full border border-[#DDDDDD] mt-3">
    <div class=" w-full ">
        <div class="grid grid-cols-11 me-[16px]">
            <div
                class="bg-[#3498DB] text-white p-1 text-[11px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px]  border-linesolvee font-bold border-e-0 flex justify-center items-center  ">
                <input type="checkbox" id="select-all-check" (change)="toggleSelectAll($event)" style height="3px">
            </div>
            <div
                class="bg-[#3498DB] text-white p-1 text-[11px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px]  border-linesolvee font-bold border-e-0 flex justify-center items-center  ">
                SNo</div>
            <div
                class="bg-[#3498DB] text-white p-1 text-[11px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px]  border-linesolvee font-bold border-e-0 flex justify-center items-center  ">
                Emp Id</div>
            <div
                class="bg-[#3498DB] text-white p-1 text-[11px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px]  border-linesolvee font-bold border-e-0 flex justify-center items-center  ">
                Emp Name</div>
            <div
                class="bg-[#3498DB] text-white p-1 text-[11px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px]  border-linesolvee font-bold border-e-0 flex justify-center items-center  ">
                From Date</div>
            <div
                class="bg-[#3498DB] text-white p-1 text-[11px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px]  border-linesolvee font-bold border-e-0 flex justify-center items-center  ">
                To Date</div>
            <div
                class="bg-[#3498DB] text-white p-1 text-[11px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px]  border-linesolvee font-bold border-e-0 flex justify-center items-center  ">
                Leave Type</div>
            <div
                class="bg-[#3498DB] text-white p-1 text-[11px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px]  border-linesolvee font-bold border-e-0 flex justify-center items-center  ">
                Reason</div>
                <div
                class="bg-[#3498DB] text-white p-1 text-[11px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px]  border-linesolvee font-bold border-e-0 flex justify-center items-center  ">
                Approver</div>
            <div
                class="bg-[#3498DB] text-white p-1 text-[11px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px]  border-linesolvee font-bold border-e-0 flex justify-center items-center  ">
                Status</div>
            <div
                class="bg-[#3498DB] text-white p-1 text-[11px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px]  border-linesolvee font-bold  flex justify-center items-center  ">
                Action</div>
        </div>
    </div>
    <div class=" w-full h-90 overflow-y-scroll">
        @if(paginatedleave.length>0)
        {
        <div class="grid grid-cols-11" *ngFor="let leave of paginatedleave; let i = index">

            <div
                class="border-linesolvees p-1 text-[10px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px] border border-[#DDDDDD] border-t-0 border-e-0 flex justify-center items-center content-center ">
                <input type="checkbox" class="checkbox" [(ngModel)]="leave.selected"
                    [disabled]="leave.status === 'Approved' || leave.status === 'Reject'"></div>
            <div
                class="border-linesolvees p-1 text-[10px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px] border border-[#DDDDDD] border-t-0 border-e-0 flex justify-center items-center content-center ">
                {{ (currentPage - 1) * pageSize + i + 1 }} </div>
            <div
                class="border-linesolvees p-1 text-[10px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px] border border-[#DDDDDD] border-t-0 border-e-0 flex justify-center items-center content-center ">
                {{leave.user_Pk_Id}} </div>
            <div
                class="border-linesolvees p-1 text-[10px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px] border border-[#DDDDDD] border-t-0 border-e-0 flex  items-center  ">
               {{leave.display_Name}}</div>
            <div
                class="border-linesolvees p-1 text-[10px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px] border border-[#DDDDDD] border-t-0 border-e-0 flex justify-center  items-center  ">
                 {{leave.from_Date}}</div>
            <div
                class="border-linesolvees p-1 text-[10px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px] border border-[#DDDDDD] border-t-0 border-e-0 flex justify-center items-center   ">
                {{leave.to_Date}}</div>
            <div
                class="border-linesolvees p-1 text-[10px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px] border border-[#DDDDDD] border-t-0 border-e-0 flex items-center ">
                {{leave.leave_Description}}</div>
            <div
                class="border-linesolvees p-1 text-[10px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px] border border-[#DDDDDD] border-t-0 border-e-0 flex  items-center remarks-column">
                {{leave.reason}}</div>
            <div
                class="border-linesolvees p-1 text-[10px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px] border border-[#DDDDDD] border-t-0 border-e-0 flex items-center ">
                {{leave.approved_By}}</div>
            <div class="border-linesolvees p-1 text-[10px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px] border border-[#DDDDDD] border-t-0 border-e-0 flex justify-center items-center content-center "
            [ngStyle]="{'color': getStatusColor(leave.status)}"> {{ leave.status }} </div>
            <div
                class="border-linesolvees p-1 gap-2 text-[10px] xs:text-[3px] sm:text-[5px] lg:text[8px] md:text-[10px] xl:text-[13px] 2xl:text-[15px] border border-[#DDDDDD] border-t-0 flex justify-center items-center content-center ">

                <button class="cursor-pointer bg-green-700 text-white w-10 h-7 rounded" (click)="approveEntry(leave)"
                    [disabled]="leave.status === 'Approved' || leave.status === 'Reject'">&#10003;</button>
                <button class="cursor-pointer bg-red-600 text-white w-10 h-7 rounded"  (click)="rejectEntry(leave)"
                    [disabled]="leave.status === 'Approved' || leave.status === 'Reject'">&#10007;</button>
            </div>
        </div>
    }
    @else {
        <div *ngIf="!isLoading && submittedleave.length === 0" class="mt-3 flex justify-center text-gray-400">
            No Leave Approval found.
        </div>
    }
    </div>
</div>


<div *ngIf="isLoading" class="loading-spinner">
    Loading LeaveApproval...
</div>

<div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
</div>
<!-- ðŸ”¹ Pagination Controls -->
<div class="flex p-2 w-full justify-end content-end items-center gap-2">
    <button [ngClass]="currentPage === 1?'bg-[#CCCCCC]':'bg-[#007BFF]'" class="p-2   text-white rounded" (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1"><</button>
    <span>Page {{ currentPage }} of {{ totalPages }}</span>
    <button [ngClass]="currentPage >= totalPages?'bg-[#CCCCCC]':'bg-[#007BFF]'" class="p-2 text-white rounded"  (click)="changePage(currentPage + 1)" [disabled]="currentPage >= totalPages">></button>
</div>
